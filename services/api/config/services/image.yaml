parameters:
  supported_image_formats:
    - 'image/bmp'
    - 'image/png'
    - 'image/jpeg'
    - 'image/jpg'
    - 'image/gif'
    - 'image/webp'
    - 'image/svg+xml'
    - 'image/svg'
    - 'image/x-icon'
    - 'image/vnd.microsoft.icon'
    - 'image/x-tga'
    - 'image/avif'
    - 'image/heic'
    - 'image/heif'
    - 'image/tiff'
    - 'image/tif'

  supports_resize: ['image/bmp', 'image/png', 'image/jpeg', 'image/jpg', 'image/webp', 'image/gif', 'image/avif']
  supports_strip_exif: ['image/jpeg', 'image/jpg', 'image/heic', 'image/heif', 'image/tiff', 'image/tif']
  enforce_conversion: ['image/heic', 'image/heif', 'image/tiff', 'image/tif']

services:
  grpc.channel_credentials:
    class: Grpc\ChannelCredentials
    factory: [Grpc\ChannelCredentials, createInsecure]

  Slink\Image\Grpc\ImageServiceClient:
    arguments:
      $hostname: '%env(IMAGE_GRPC_HOST)%'
      $opts:
        credentials: '@grpc.channel_credentials'

  Slink\Image\Infrastructure\Service\GrpcImageProcessor:
    arguments:
      $grpcClient: '@Slink\Image\Grpc\ImageServiceClient'

  Slink\Image\Domain\Service\ImageProcessorInterface:
    alias: Slink\Image\Infrastructure\Service\GrpcImageProcessor

  Slink\Image\Application\Service\GrpcImageTransformer:
    arguments:
      $imageProcessor: '@Slink\Image\Domain\Service\ImageProcessorInterface'

  Slink\Image\Domain\Service\ImageTransformerInterface:
    alias: Slink\Image\Application\Service\GrpcImageTransformer

  Slink\Image\Domain\Service\ImageAnalyzerInterface:
    alias: Slink\Image\Application\Service\ImageAnalyzer
